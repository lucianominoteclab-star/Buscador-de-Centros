<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Centros</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f3f4f6;
            padding: 20px;
        }
        .contenedor {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        button {
            width: 100%;
            padding: 12px;
            background: #2563eb;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #1e3fa3;
        }
        #resultado {
            margin-top: 20px;
            opacity: 0;
            transition: opacity .4s ease;
        }
        #resultado.visible {
            opacity: 1;
        }
        #mapa {
            width: 100%;
            height: 300px;
            margin-top: 20px;
            border-radius: 12px;
        }
    </style>

    <!-- Leaflet (mapas) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

<div class="contenedor">
    <h2>Buscador de Centros</h2>
    <input type="text" id="localidad" placeholder="Ingres치 tu localidad (ej: Virrey del Pino)">
    <button id="buscar">Buscar centro 游늸</button>

    <div id="resultado"></div>
    <div id="mapa"></div>
</div>

<script>
    // Localidades con coordenadas
    const localidades = {
        "virrey del pino": { lat: -34.8137, lon: -58.6814 },
        "merlo": { lat: -34.6654, lon: -58.7276 },
        "ca침uelas": { lat: -35.0526, lon: -58.7401 }
        // Agreg치 m치s localidades ac치
    };

    // Centros Teclab
    const centros = [
        { nombre: "Merlo", direccion: "Avellaneda 598", lat: -34.6654, lon: -58.7276 },
        { nombre: "Ca침uelas", direccion: "Libertad 200", lat: -35.0526, lon: -58.7401 },
        { nombre: "San Justo", direccion: "Arieta 3300", lat: -34.6764, lon: -58.5611 }
        // Agreg치 m치s centros si quer칠s
    ];

    // Calcular distancia Haversine
    function haversine(lat1, lon1, lat2, lon2) {
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a =
            Math.sin(dLat / 2) ** 2 +
            Math.cos(lat1 * Math.PI / 180) *
            Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) ** 2;

        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }

    // Crear mapa
    const mapa = L.map('mapa').setView([-34.70, -58.60], 9);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19
    }).addTo(mapa);

    let marcadorUsuario;
    let marcadoresCentros = [];

    // Buscar centro
    document.getElementById("buscar").addEventListener("click", () => {
        const input = document.getElementById("localidad").value.trim().toLowerCase();
        const datosUsuario = localidades[input];

        if (!datosUsuario) {
            alert("Localidad no encontrada");
            return;
        }

        // Calcular distancias
        const distancias = centros.map(c => ({
            nombre: c.nombre,
            direccion: c.direccion,
            lat: c.lat,
            lon: c.lon,
            distancia: haversine(datosUsuario.lat, datosUsuario.lon, c.lat, c.lon)
        }));

        // Ordenar
        distancias.sort((a, b) => a.distancia - b.distancia);

        const primero = distancias[0];
        const segundo = distancias[1];

        // Mostrar texto con animaci칩n
        const res = document.getElementById("resultado");
        res.innerHTML = `
            <h3>Centro m치s cercano:</h3>
            <p><strong>${primero.nombre}</strong><br>
            Direcci칩n: ${primero.direccion}<br>
            Distancia aprox: ${primero.distancia.toFixed(2)} km</p>

            <hr>

            <h3>Segundo centro m치s cercano:</h3>
            <p><strong>${segundo.nombre}</strong><br>
            Direcci칩n: ${segundo.direccion}<br>
            Distancia aprox: ${segundo.distancia.toFixed(2)} km</p>
        `;
        res.classList.add("visible");

        // Limpiar marcadores anteriores
        if (marcadorUsuario) marcadorUsuario.remove();
        marcadoresCentros.forEach(m => m.remove());
        marcadoresCentros = [];

        // Marcar ubicaci칩n del usuario
        marcadorUsuario = L.marker([datosUsuario.lat, datosUsuario.lon]).addTo(mapa)
            .bindPopup("游늸 Vos est치s ac치").openPopup();

        // Marcar los 2 centros m치s cercanos
        [primero, segundo].forEach(c => {
            const m = L.marker([c.lat, c.lon])
                .addTo(mapa)
                .bindPopup(`<b>${c.nombre}</b><br>${c.direccion}<br>${c.distancia.toFixed(1)} km`);
            marcadoresCentros.push(m);
        });

        // Mover mapa
        mapa.setView([datosUsuario.lat, datosUsuario.lon], 10);
    });
</script>

</body>
</html>
