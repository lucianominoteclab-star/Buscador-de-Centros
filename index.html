<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buscador de Centros Siglo 21</title>

  <style>
    :root {
      --verde21: #0c3b2e;
      --verde21-light: #105c47;
      --fondo: #f5f5f5;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--fondo);
      text-align: center;
    }

    header {
      background: var(--verde21);
      padding: 22px;
      color: white;
      font-size: 24px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    h2 {
      color: var(--verde21);
    }

    .card {
      background: white;
      width: 90%;
      max-width: 550px;
      margin: 25px auto;
      padding: 25px;
      border-radius: 18px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    input {
      width: 90%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      margin-bottom: 10px;
    }

    button {
      background: var(--verde21);
      color: white;
      border: none;
      padding: 12px 22px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: var(--verde21-light);
    }

    #resultado-card {
      display: none;
      background: white;
      width: 90%;
      max-width: 650px;
      margin: 30px auto;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.35s ease;
      text-align: left;
      border-left: 8px solid var(--verde21);
    }

    .centro {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 10px;
      background: #f0f7f5;
      border-left: 4px solid var(--verde21);
    }

    .mapa {
      width: 100%;
      border-radius: 12px;
      margin-top: 15px;
    }
  </style>
</head>

<body>

  <header>Buscador de Centros Siglo 21</header>

  <div class="card">
    <h2>Ingres√° tu localidad</h2>
    <input id="localidad" placeholder="Ej: Virrey del Pino, San Miguel, etc..." />
    <button onclick="buscarCentro()">Buscar centro</button>
    <p id="estado" style="color:gray; font-size:14px;"></p>
  </div>

  <div id="resultado-card">
    <h2>üìç Resultado</h2>
    <div id="resultado"></div>
    <img id="mapa" class="mapa" src="" alt="Mapa de ruta" />
  </div>

  <script>
    /* ============================================
       CENTROS - CON COORDENADAS DE GOOGLE MAPS
       ============================================ */
    const centros = [
      { nombre: "San Miguel", dir: "Av. Le√≥n Gallardo 207, San Miguel", lat: -34.54313, lon: -58.71267 },
      { nombre: "Don Torcuato", dir: "√Ångel T. de Alvear 2555, Don Torcuato", lat: -34.47175, lon: -58.63324 },
      { nombre: "Hurlingham", dir: "Arturo Jauretche 1435, Hurlingham", lat: -34.58626, lon: -58.63928 },
      { nombre: "Ca√±uelas", dir: "Libertad 1200, Ca√±uelas", lat: -35.0526, lon: -58.7541 },
      { nombre: "San Mart√≠n", dir: "Sarmiento 1887, San Mart√≠n", lat: -34.56873, lon: -58.5416 },
      { nombre: "Parque Leloir", dir: "Mart√≠n Fierro 3246, Parque Leloir", lat: -34.6331, lon: -58.6876 },
      { nombre: "Munro", dir: "V√©lez Sarsfield 4898, Munro", lat: -34.5305, lon: -58.5219 },
      { nombre: "Merlo", dir: "Avellaneda 673, Merlo", lat: -34.6693, lon: -58.7291 },
      { nombre: "Banfield", dir: "Vieytes 211, Banfield", lat: -34.74188, lon: -58.39118 }
    ];

    /* ============================================
       HAVERSINE PARA DISTANCIA REAL
       ============================================ */
    function haversine(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a =
        Math.sin(dLat / 2) ** 2 +
        Math.cos(lat1 * Math.PI / 180) *
        Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) ** 2;
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }

    /* ============================================
       CARGAR DESDE CACHE PARA ACELERAR
       ============================================ */
    const cache = JSON.parse(localStorage.getItem("cacheRutas") || "{}");

    /* ============================================
       BUSCAR CENTROS
       ============================================ */
    function buscarCentro() {
      const loc = document.getElementById("localidad").value.trim();
      const estado = document.getElementById("estado");
      if (!loc) return;

      estado.textContent = "Buscando ubicaci√≥n‚Ä¶";

      // Si ya est√° en cach√© ‚Üí carga instant√°nea
      if (cache[loc]) {
        mostrarResultado(cache[loc]);
        estado.textContent = "Resultado cargado desde cach√© ‚úîÔ∏è";
        return;
      }

      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${loc} Buenos Aires Argentina`)
        .then(r => r.json())
        .then(data => {
          if (data.length === 0) {
            estado.textContent = "No se encontr√≥ la localidad.";
            return;
          }

          const userLat = parseFloat(data[0].lat);
          const userLon = parseFloat(data[0].lon);

          // Calculamos distancias reales
          const distancias = centros.map(c => ({
            ...c,
            dist: haversine(userLat, userLon, c.lat, c.lon)
          }));

          // Ordenar del m√°s cercano al m√°s lejano
          distancias.sort((a, b) => a.dist - b.dist);

          const resultado = {
            localidad: loc,
            origen: { lat: userLat, lon: userLon },
            primero: distancias[0],
            segundo: distancias[1]
          };

          // Guardamos en cach√©
          cache[loc] = resultado;
          localStorage.setItem("cacheRutas", JSON.stringify(cache));

          mostrarResultado(resultado);
          estado.textContent = "";
        });
    }

    /* ============================================
       MOSTRAR RESULTADO + MAPA
       ============================================ */
    function mostrarResultado(res) {
      const card = document.getElementById("resultado-card");
      const cont = document.getElementById("resultado");
      const mapa = document.getElementById("mapa");

      card.style.display = "block";
      setTimeout(() => {
        card.style.opacity = "1";
        card.style.transform = "translateY(0)";
      }, 30);

      cont.innerHTML = `
      <div class="centro">
        <b>Centro m√°s cercano:</b> ${res.primero.nombre}<br>
        <b>Direcci√≥n:</b> ${res.primero.dir}<br>
        <b>Distancia:</b> ${res.primero.dist.toFixed(2)} km<br>
      </div>

      <div class="centro">
        <b>Segundo centro m√°s cercano:</b> ${res.segundo.nombre}<br>
        <b>Direcci√≥n:</b> ${res.segundo.dir}<br>
        <b>Distancia:</b> ${res.segundo.dist.toFixed(2)} km
      </div>
    `;

      // MAPA EST√ÅTICO SIN API KEY (casi-ruta)
      mapa.src =
        `https://staticmap.openstreetmap.de/staticmap.php?center=${res.origen.lat},${res.origen.lon}` +
        `&zoom=11&size=600x350&maptype=mapnik` +
        `&markers=${res.origen.lat},${res.origen.lon},lightblue1` +
        `|${res.primero.lat},${res.primero.lon},darkgreen1`;
    }

    // ENTER para buscar
    document.getElementById("localidad").addEventListener("keypress", e => {
      if (e.key === "Enter") buscarCentro();
    });
  </script>
</body>

</html>
