<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buscador de Centros Siglo 21</title>

  <style>
    :root { --verde:#0c3b2e; --verde-dark:#0a3a2a; }
    body { font-family: Arial, Helvetica, sans-serif; margin:0; background:#f4f6f7; color:#111 }
    header { background:var(--verde); color:#fff; padding:18px; text-align:center; font-weight:700 }
    .wrap { max-width:1100px; margin:20px auto; padding:16px; }
    .card { background:#fff; border-radius:10px; padding:16px; box-shadow:0 6px 18px rgba(0,0,0,.06) }
    .controls { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px }
    input[type="text"] { flex:1; padding:10px 12px; border-radius:8px; border:1px solid #d0d7d5; font-size:15px }
    button { background:var(--verde); color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer }
    button:hover { background:var(--verde-dark) }
    #info { margin-top:12px }
    #map { height:420px; border-radius:8px; margin-top:12px }
    .result-block { margin:10px 0; }
    .res { background:#fbfffb; border-left:6px solid var(--verde); padding:10px; border-radius:8px; margin-bottom:10px }
    .small { font-size:13px; color:#555 }
    @media(max-width:720px){ .controls{flex-direction:column} }
  </style>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
  <header>Buscador de Centros Siglo 21</header>

  <div class="wrap">
    <div class="card">
      <div class="controls">
        <input id="localidad" type="text" placeholder="Ingresá tu localidad (ej: Virrey del Pino)" />
        <button id="buscarBtn">Buscar</button>
      </div>
      <div id="resultsArea">
        <div class="result-block" id="resultsBlock" style="display:none">
          <div class="res" id="firstRes"></div>
          <div class="res" id="secondRes"></div>
        </div>
      </div>
      <div id="map"></div>
    </div>
  </div>

<script>
  // Coordenadas fijas de tus centros
  const centros = [
    { label:"Cau San Miguel", lat: -34.54313, lon: -58.71267, address:"Av. León Gallardo 207, San Miguel" },
    { label:"Cau Don Torcuato", lat: -34.47175, lon: -58.63324, address:"Av. Ángel T. de Alvear 2555, Don Torcuato" },
    { label:"Cau Hurlingham", lat: -34.58626, lon: -58.63928, address:"Arturo Jauretche 1435, Hurlingham" },
    { label:"Cau Cañuelas", lat: -35.0526,  lon: -58.7541,  address:"Av. Libertad 1200, Cañuelas" },
    { label:"Cau San Martín", lat: -34.56873, lon: -58.5416,  address:"Sarmiento 1887, San Martín" },
    { label:"Cau Parque Leloir", lat: -34.63310, lon: -58.68760, address:"Av. Martín Fierro 3246, Parque Leloir" },
    { label:"Cau Munro", lat: -34.53050, lon: -58.52190, address:"Vélez Sársfield 4898, Munro" },
    { label:"Cau Merlo", lat: -34.66930, lon: -58.72910, address:"Avellaneda 673, Merlo" },
    { label:"Cau Banfield", lat: -34.74188, lon: -58.39118, address:"Vieytes 211, Banfield" }
  ];

  // Mapa
  const map = L.map('map').setView([-34.65, -58.5], 10);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom:19 }).addTo(map);

  let userMarker = null;
  let markers = [];

  function haversineKm(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2-lat1)*Math.PI/180;
    const dLon = (lon2-lon1)*Math.PI/180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  }

  async function buscar() {
    const loc = document.getElementById("localidad").value.trim();
    if (!loc) { alert("Ingresá una localidad"); return; }

    // Geocodificar SOLO la localidad ingresada (no requiere API key)
    let lat, lon;
    try {
      const res = await fetch(
        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(loc + ", Buenos Aires, Argentina")}&limit=1`,
        { headers:{'Accept-Language':'es'} }
      );
      const js = await res.json();
      if (!js || js.length === 0) {
        alert("No se encontró la localidad. Revisá la ortografía.");
        return;
      }
      lat = parseFloat(js[0].lat);
      lon = parseFloat(js[0].lon);
    } catch(e) {
      alert("Error al geocodificar la localidad");
      return;
    }

    // Calcular distancias
    const lista = centros.map(c => ({
      ...c,
      dist: haversineKm(lat, lon, c.lat, c.lon)
    }));

    lista.sort((a,b)=>a.dist - b.dist);

    const primero = lista[0];
    const segundo = lista[1];

    // Mostrar resultados
    document.getElementById("resultsBlock").style.display = 'flex';
    document.getElementById("firstRes").innerHTML =
      `<b>${primero.label}</b><br>${primero.address}<br>Distancia: ${primero.dist.toFixed(2)} km`;

    document.getElementById("secondRes").innerHTML =
      `<b>${segundo.label}</b><br>${segundo.address}<br>Distancia: ${segundo.dist.toFixed(2)} km`;

    // Limpiar marcadores
    if (userMarker) userMarker.remove();
    markers.forEach(m=>m.remove());
    markers = [];

    // Marcar usuario
    userMarker = L.marker([lat, lon])
      .addTo(map)
      .bindPopup(`Localidad: ${loc}`)
      .openPopup();

    // Marcar centros
    [primero, segundo].forEach(c => {
      const mk = L.marker([c.lat, c.lon])
        .addTo(map)
        .bindPopup(`${c.label}<br>${c.address}<br>${c.dist.toFixed(1)} km`);
      markers.push(mk);
    });

    // Ajustar vista
    const pts = [[lat, lon], [primero.lat, primero.lon], [segundo.lat, segundo.lon]];
    map.fitBounds(pts, { padding:[50,50] });
  }

  document.getElementById("buscarBtn").addEventListener("click", buscar);
  document.getElementById("localidad").addEventListener("keypress", e => {
    if (e.key === "Enter") buscar();
  });

</script>

</body>
</html>
